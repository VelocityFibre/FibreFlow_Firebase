<!DOCTYPE html>
<html>
<head>
    <title>vf-onemap-data Import Tool</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        textarea { width: 100%; height: 200px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>vf-onemap-data Import Tool</h1>
    
    <div id="auth-status" class="status info">Checking authentication...</div>
    
    <div id="main" style="display: none;">
        <h2>Import CSV Data</h2>
        <p>Paste your CSV data below:</p>
        <textarea id="csv-data" placeholder="Paste CSV content here..."></textarea>
        <br><br>
        <button onclick="importData()">Import to vf-onemap-data</button>
        
        <div id="results"></div>
    </div>

    <script>
        // TODO: Get these values from Firebase Console
        const firebaseConfig = {
            apiKey: "YOUR-API-KEY",
            authDomain: "vf-onemap-data.firebaseapp.com",
            projectId: "vf-onemap-data",
            storageBucket: "vf-onemap-data.appspot.com",
            messagingSenderId: "YOUR-SENDER-ID",
            appId: "YOUR-APP-ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Check authentication
        auth.onAuthStateChanged(user => {
            const authStatus = document.getElementById('auth-status');
            const main = document.getElementById('main');
            
            if (user) {
                authStatus.className = 'status success';
                authStatus.textContent = `Logged in as: ${user.email}`;
                main.style.display = 'block';
            } else {
                authStatus.className = 'status info';
                authStatus.innerHTML = 'Not logged in. <button onclick="login()">Login with Google</button>';
                main.style.display = 'none';
            }
        });

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider);
        }

        async function importData() {
            const csvData = document.getElementById('csv-data').value;
            const results = document.getElementById('results');
            
            if (!csvData) {
                results.innerHTML = '<div class="status error">Please paste CSV data</div>';
                return;
            }
            
            results.innerHTML = '<div class="status info">Importing...</div>';
            
            try {
                // Parse CSV (simplified)
                const lines = csvData.split('\\n');
                const headers = lines[0].split(',');
                let imported = 0;
                
                const batch = db.batch();
                
                for (let i = 1; i < lines.length && i < 10; i++) { // Limit to 10 for demo
                    const values = lines[i].split(',');
                    if (values[0]) { // Property ID
                        const docRef = db.collection('vf-onemap-processed-records').doc(values[0]);
                        batch.set(docRef, {
                            propertyId: values[0],
                            importDate: firebase.firestore.FieldValue.serverTimestamp(),
                            // Add more fields as needed
                        }, { merge: true });
                        imported++;
                    }
                }
                
                await batch.commit();
                
                results.innerHTML = `
                    <div class="status success">
                        âœ… Successfully imported ${imported} records to vf-onemap-data!
                        <br><br>
                        <a href="https://console.firebase.google.com/project/vf-onemap-data/firestore/data/~2Fvf-onemap-processed-records" target="_blank">
                            View in Firebase Console
                        </a>
                    </div>
                `;
                
            } catch (error) {
                results.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
            }
        }
    </script>
    
    <hr>
    <h3>Setup Instructions:</h3>
    <ol>
        <li>Get Firebase config from: <a href="https://console.firebase.google.com/project/vf-onemap-data/settings/general" target="_blank">Project Settings</a></li>
        <li>Update the firebaseConfig object above</li>
        <li>Open this HTML file in a browser</li>
        <li>Login with your Google account (louis@velocityfibreapp.com)</li>
        <li>Paste CSV data and click Import</li>
    </ol>
</body>
</html>